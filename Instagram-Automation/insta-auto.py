################################################### Instagram Automation ####################################################
################################################ Developed By Avdhesh Varshney ##############################################
############################################ (https://github.com/Avdhesh-Varshney) ##########################################

"""Install Python Packages as listed below using these commands in the terminal

Sr. No.         Package Name             Commands
1.              os                       pip install os
2.              random                   pip install random
3.              instaloader              pip install instaloader
4.              instabot                 pip install instabot

After install all these packages then import all of them in this file."""

# Importing libraries
import os
import random
import instaloader
from instabot import Bot
from time import sleep

os.system("cls" if os.name == "nt" else "clear")

# Global variables for username and password
print("\nWelcome to Instagram Automation ü§ñ\n")
username = input("Enter your Instagram username: ")
password = input("\nEnter your Instagram password: ")


# Function to tell about your profile id number
def profileIDNumber():
    loader = instaloader.Instaloader()
    id = instaloader.Profile.from_username(loader.context, username)

    print(f"Your profile ID is - {id}")


# Function to download the profile picture of a user using instaloader
def downloadProfilePicture():
    loader = instaloader.Instaloader()
    # Download the profile picture
    loader.download_profile(username, profile_pic_only=True)

    print(f"Profile picture of {username} downloaded.")


# Function to like posts from a user's profile using instabot
def likeUserPosts():
    bot = Bot()
    bot.login(username=username, password=password)

    # Get the user's recent posts
    userPosts = bot.get_user_medias(username=username, filtration=None)

    # Randomly like a few posts
    numPostsToLike = min(5, len(userPosts))
    postsToLike = random.sample(userPosts, numPostsToLike)
    for post in postsToLike:
        bot.like(media_id=post.pk)
        print(f"Liked post with caption: {post.caption.text}")

    bot.logout()


# Function to follow a user using instabot
def followUser():
    bot = Bot()
    bot.login(username=username, password=password)

    # Follow the user
    userToFollow = input("\nEnter the username to follow: ")
    sleep(60)
    bot.follow(userToFollow)
    print(f"Followed user: {userToFollow}")

    bot.logout()


# Function to unfollow a user using instabot
def unfollowUser():
    bot = Bot()
    bot.login(username=username, password=password)

    # Unfollow the user
    userToUnfollow = input("\nEnter the username to unfollow: ")
    bot.unfollow(userToUnfollow)
    print(f"Unfollowed user: {userToUnfollow}")

    bot.logout()


# Function to send a direct message using instabot
def sendDirectMessage():
    bot = Bot()
    bot.login(username=username, password=password)

    # Send the direct message
    userToMessage = input("\nEnter the username to send a direct message: ")
    message = input("Enter the message: ")
    bot.send_message(message, [bot.get_user_id_from_username(userToMessage)])

    bot.logout()


# Function to download a user's recent posts and stories using instaloader
def downloadUserData():
    loader = instaloader.Instaloader()
    profile = instaloader.Profile.from_username(loader.context, username)

    # Download recent posts
    loader.download_posts(profile, max_count=10)

    # Download stories
    stories = profile.get_stories()
    for story in stories:
        loader.download_storyitem(story, filename_prefix=f"{username}_story_")

    print(f"Downloaded recent posts and stories of {username}.")


# Function to download multiple profiles using instaloader
def downloadMultipleProfiles():
    loader = instaloader.Instaloader()
    usernames = input("Enter multiple usernames separated by spaces: ").split()
    for user in usernames:
        profile = instaloader.Profile.from_username(loader.context, user)
        loader.download_profile(profile, download_stories=True)
    print("Downloaded profiles and their stories.")


# Function to get hashtag information using instabot
def getHashtagInfo():
    bot = Bot()
    bot.login(username=username, password=password)

    # Get the top posts for the hashtag
    hashtag = input("\nEnter the hashtag to get information: ")
    topPosts = bot.get_hashtag_medias(hashtag)

    print(f"Top posts for the hashtag: {hashtag}")
    for post in topPosts:
        print(f"Post URL: {post.link}")

    bot.logout()


# Main function
def main():
    while True:
        # Get user's choice
        os.system("cls")
        print(
            """\n*********************** Welcome to Instagram Automation ü§ñ ***********************\n
            \tEnter 1Ô∏è‚É£  to download a user's profile picture
            \tEnter 2Ô∏è‚É£  to like posts from a user's profile
            \tEnter 3Ô∏è‚É£  to follow a user
            \tEnter 4Ô∏è‚É£  to unfollow a user
            \tEnter 5Ô∏è‚É£  to send a direct message to a user
            \tEnter 6Ô∏è‚É£  to download a user's recent posts and stories
            \tEnter 7Ô∏è‚É£  to download multiple profiles and their stories
            \tEnter 8Ô∏è‚É£  to get hashtag information
            \tEnter 9Ô∏è‚É£  to know you ID number
            \tEnter 0Ô∏è‚É£  to exit the program\n"""
        )

        try:
            value = int(input("Enter your choice: "))
        except ValueError:
            print("\nInvalid input! Please enter a number from the options.")
            continue

        os.system("cls")
        print(
            "\n*********************** Welcome to Instagram Automation ü§ñ ***********************\n"
        )

        if value == 0:
            os.system("cls")
            print(
                "\n******************* Thanks for using Instagram Automation ü§ñ Program üëã *******************\n\n"
            )
            exit(0)

        elif value == 1:
            print("\nDownloading a user's profile picture\n")
            downloadProfilePicture()

        elif value == 2:
            print("\nLiking posts from a user's profile\n")
            likeUserPosts()

        elif value == 3:
            print("\nFollowing a user\n")
            followUser()

        elif value == 4:
            print("\nUnfollowing a user\n")
            unfollowUser()

        elif value == 5:
            print("\nSending a direct message to a user\n")
            sendDirectMessage()

        elif value == 6:
            print("\nDownloading a user's recent posts and stories\n")
            downloadUserData()

        elif value == 7:
            print("\nDownloading multiple profiles and their stories\n")
            downloadMultipleProfiles()

        elif value == 8:
            print("\nGetting hashtag information\n")
            getHashtagInfo()

        elif value == 9:
            print("\nFetching Data\n")
            profileIDNumber()

        else:
            print("\nInvalid choice. Please enter a valid number from the options.\n")

        input("\n\nPress 'Enter Key' to continue !\n\n")


# Driver function
if __name__ == "__main__":
    main()
