import re
import requests

def extract_ip_from_header(header):
    # Regular expression to find the first occurrence of an IP address in the header
    ip_pattern = r'\b(?:\d{1,3}\.){3}\d{1,3}\b'
    match = re.search(ip_pattern, header)
    if match:
        return match.group()

def get_location_from_ip(ip):
    url = f"http://ipinfo.io/{ip}/json"
    response = requests.get(url)
    if response.status_code == 200:
        data = response.json()
        return data.get("ip"), data.get("city", ""), data.get("region", ""), data.get("country", "")
    else:
        return None, None, None, None

if __name__ == "__main__":
    # Assuming you have the email header in 'email_header' variable
    email_header = ""

    sender_ip = extract_ip_from_header(email_header)

    if sender_ip:
        ip_address, city, region, country = get_location_from_ip(sender_ip)
        if ip_address:
            print("1-) Traceable to which device:")
            print(f"   IP Address: {ip_address}")
            print(f"   Location: {city}, {region}, {country}")
            print("2-) Mail is sent from approximately which location:")
            print(f"   Location: {city}, {region}, {country}")
        else:
            print("IP geolocation data not available for the given IP address.")
    else:
        print("No IP address found in the email header.")
